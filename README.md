# fastify-blog-example

Небольшой блог с использованием [Fastify](https://fastify.dev/), [React](https://react.dev/) и [openapi-client-axios](https://openapistack.co/docs/openapi-client-axios/intro/).

## Мотивация

Я посмотрел разных репо, но не смог найти такого, что решало бы все следующие проблемы одновременно.

- Использование монорепо. Использование разрозненных репозиториев усложняет процесс работы над несколькими проектами одновременно, Find All References на методе покажет не весь список проектов, где он используется. В монорепо же можно переименовать метод и быть уверенным, что изменение произойдет во всех зависимых проектах.
- Установка только необходимых зависимостей. Зачастую монорепо сильно разрастается, хотелось бы устанавливать зависимости только для проектов, над которыми сейчас работаешь. `pnpm`, в целом, решает эту проблему при помощи [фильтров](https://pnpm.io/filtering#--filter-package_name-1).
- Использование TypeScript. TS в монорепо требует отдельной настройки (project references);
- **Правильное** использование TS. Например, в коде фронта разрешено использовать API DOM-а, в коде сервера - нет, зато там должны быть доступны node types, которых нет на фронте. VSCode, естественно, должен ругаться при в случае нарушения этих правил.
- Поддержка path aliases в tsconfig. `ts-node` игнорирует их, если не поставить плагин. А вот `esbuild` и производный от него `tsx` подхватывают сразу.
- Работа как с ESM, так и c require. Как-то я использовал две библиотеки, при этом одна предоставляла только ESM экспорты; другая - только CJS (require).
  Установка `"type": "module"` в `package.json` позволяла импортировать ESM, но не CJS; удаление этой опции приводило к обратном результату.
  В итоге я плюнул на `ts-node` и перешел на `tsx`, основанный на `esbuild`. Он поддерживает обе системы модулей без всякой настройки.
- Сборка без использования `tsc`. Многие примеры предлагают компилировать код, используя `tsc` во временные js-файлы, затем запускать их через `node`.
  По этой причине я не использую, например, `fastify-cli`, который с TS работает именно так.
- Проверка типов с использованием `tsc`. Для этого необходим правильный `tsconfig`, с отключенной генерацией js и выдающий минимально необходимое количество файлов - только декларации и только в зависимых проектах.

## Установка зависимостей

```sh
pnpm i
```

## Процесс разработки

По истории коммитов можно отследить, что, когда и зачем было добавлено.

## Удобные команды для запуска

`pnpm` предоставляет удобный способ запуска нескольких команд.

### Запустить фронт и бек одновременно:

```
pnpm -F backend -F frontend start
```
